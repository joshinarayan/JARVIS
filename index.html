<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    background:#000;
    color:white;
    margin:0;
    font-family:Arial;
    display:flex;
    flex-direction:column;
    height:100vh;
}

#scanner{
    width:180px;height:180px;margin:20px auto;
    border-radius:50%;border:4px solid #00ff95;
    animation:pulse 2s infinite;
    box-shadow:0 0 25px #00ff95;
}
@keyframes pulse{
 0%{transform:scale(1);}50%{transform:scale(1.1);}100%{transform:scale(1);}
}

#chat-box{
 flex:1;overflow-y:auto;padding:10px;font-size:17px;
}
.message{margin-bottom:10px;padding:8px;border-radius:6px;max-width:80%;}
.user{background:#0066ff44;margin-left:auto;}
.bot{background:#00ff9544;}

#input-area{
 position:fixed;bottom:0;width:100%;display:flex;background:#111;padding:10px;
}
#user-input{
 flex:1;padding:12px;font-size:18px;background:#222;border:none;color:white;
}
button{
 padding:12px;background:#00ff95;border:none;color:black;font-weight:bold;font-size:18px;margin-left:6px;
}
</style>
</head>

<body>

<div id="scanner"></div>
<div id="chat-box"></div>

<div id="input-area">
   <input id="user-input" placeholder="Speak to me sir..."/>
   <button onclick="sendMessage()">Send</button>
</div>
<script>
let voiceGender="male";

function speak(text){
    const msg = new SpeechSynthesisUtterance(text);

    msg.voice = speechSynthesis.getVoices().find(v =>
        v.name.toLowerCase().includes("male") ||
        v.name.toLowerCase().includes("david") ||
        v.name.toLowerCase().includes("john") ||
        v.name.toLowerCase().includes("english")
    ) || speechSynthesis.getVoices()[0];

    msg.rate = 1.0;
    msg.pitch = 0.75;      // deeper voice ðŸ”¥ JARVIS vibe
    msg.volume = 1;
    speechSynthesis.speak(msg);
}

function addMessage(text,type){
   const box=document.getElementById("chat-box");
   const msg=document.createElement("div");
   msg.className="message "+type;
   msg.style.wordBreak="break-word";  // ðŸ”¥ stays inside bubble
   msg.innerHTML=text.replace(/([.!?])\s*/g,"$1 "); // auto spacing âœ”
   box.appendChild(msg);
   box.scrollTop=box.scrollHeight;
   return msg;
}

async function sendMessage(){
    const input=document.getElementById("user-input");
    const text=input.value.trim();
    if(!text) return;

    addMessage(text,"user");
    const botMsg=addMessage("ðŸ”„ Processing sir...","bot");
    input.value="";

    try{
        const res = await fetch("https://jarvis-backend-lllv.onrender.com/api/ask",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({ message:text })
        });

        const data=await res.json();
        if(!data.reply){
            botMsg.innerText="âŒ No response received sir.";
            return;
        }

        botMsg.innerHTML="";
        let i=0, reply=data.reply;

        let type=setInterval(()=>{
            botMsg.innerHTML+=reply[i];
            i++;
            if(i>=reply.length){
                clearInterval(type);
                speak(reply);
            }
        },30);

    }catch{
        botMsg.innerText="Connection failed sir.";
    }
}
</script>

</body>
</html>
